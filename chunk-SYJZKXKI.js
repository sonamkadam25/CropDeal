import{a as z,c as B,e as L,j as R,k as j,l as H,n as U}from"./chunk-MDTR3QT2.js";import{b as D}from"./chunk-VARBTXGR.js";import{Ea as y,Gb as N,Hb as A,Ia as h,Kb as W,Pa as _,Qa as I,Sa as t,Ta as n,Va as P,Wa as O,Xa as M,Y as d,Ya as b,Z as p,Za as c,_a as F,a as S,cb as V,db as a,eb as g,fb as k,gb as x,hb as u,ib as C,nb as T,sa as v,va as i,za as w}from"./chunk-LATPFVPJ.js";function K(l,m){if(l&1&&(t(0,"div",5),a(1),n()),l&2){let e=c();i(),g(e.errorMessage)}}function Q(l,m){if(l&1){let e=M();P(0),t(1,"td"),a(2),n(),t(3,"td")(4,"input",9),C("ngModelChange",function(r){d(e);let s=c(3);return u(s.editedFarmer.name,r)||(s.editedFarmer.name=r),p(r)}),n()(),t(5,"td")(6,"input",9),C("ngModelChange",function(r){d(e);let s=c(3);return u(s.editedFarmer.email,r)||(s.editedFarmer.email=r),p(r)}),n()(),t(7,"td")(8,"input",9),C("ngModelChange",function(r){d(e);let s=c(3);return u(s.editedFarmer.phone,r)||(s.editedFarmer.phone=r),p(r)}),n()(),t(9,"td")(10,"select",9),C("ngModelChange",function(r){d(e);let s=c(3);return u(s.editedFarmer.active,r)||(s.editedFarmer.active=r),p(r)}),t(11,"option",10),a(12,"Active"),n(),t(13,"option",10),a(14,"Inactive"),n()()(),t(15,"td")(16,"button",11),b("click",function(){d(e);let r=c(3);return p(r.saveEdit())}),a(17,"Save"),n(),t(18,"button",11),b("click",function(){d(e);let r=c(3);return p(r.cancelEdit())}),a(19,"Cancel"),n()(),O()}if(l&2){let e=c().$implicit,o=c(2);i(2),g(e.id),i(2),x("ngModel",o.editedFarmer.name),i(2),x("ngModel",o.editedFarmer.email),i(2),x("ngModel",o.editedFarmer.phone),i(2),x("ngModel",o.editedFarmer.active),i(),_("value",!0),i(2),_("value",!1)}}function X(l,m){if(l&1){let e=M();t(0,"td"),a(1),n(),t(2,"td"),a(3),n(),t(4,"td")(5,"a",12),a(6),n()(),t(7,"td")(8,"a",12),a(9),n()(),t(10,"td")(11,"span"),a(12),n()(),t(13,"td")(14,"button",11),b("click",function(){d(e);let r=c().$implicit,s=c(2);return p(s.startEdit(r))}),a(15,"Edit"),n()()}if(l&2){let e=c().$implicit;i(),g(e.id),i(2),g(e.name),i(2),F("href","mailto:",e.email,"",v),i(),g(e.email),i(2),F("href","tel:",e.phone,"",v),i(),g(e.phone),i(2),I("active",e.active)("inactive",!e.active),i(),k(" ",e.active?"Active":"Inactive"," ")}}function Y(l,m){if(l&1&&(t(0,"tr"),h(1,Q,20,7,"ng-container",8)(2,X,16,13,"ng-template",null,0,T),n()),l&2){let e=m.$implicit,o=V(3),r=c(2);i(),_("ngIf",r.editFarmerId===e.id)("ngIfElse",o)}}function Z(l,m){if(l&1&&(t(0,"table",6)(1,"thead")(2,"tr")(3,"th"),a(4,"ID"),n(),t(5,"th"),a(6,"Name"),n(),t(7,"th"),a(8,"Email"),n(),t(9,"th"),a(10,"Phone"),n(),t(11,"th"),a(12,"Status"),n(),t(13,"th"),a(14,"Edit"),n()()(),t(15,"tbody"),h(16,Y,4,2,"tr",7),n()()),l&2){let e=c();i(16),_("ngForOf",e.farmers)}}function ee(l,m){l&1&&(t(0,"div",13),a(1," No farmers found. "),n())}var G=class l{constructor(m){this.http=m}farmers=[];errorMessage="";editFarmerId=null;editedFarmer={};ngOnInit(){this.getAllFarmers()}getAllFarmers(){let m=localStorage.getItem("token");if(!m){this.errorMessage="No auth token found. Please login again.";return}this.http.get("http://localhost:8000/ADMINSERVICE/admin/farmers",{headers:{Authorization:`Bearer ${m}`}}).subscribe({next:e=>{this.farmers=e},error:e=>{console.error("Error fetching farmers:",e),this.errorMessage="Failed to load farmers."}})}startEdit(m){this.editFarmerId=m.id,this.editedFarmer=S({},m)}cancelEdit(){this.editFarmerId=null,this.editedFarmer={}}saveEdit(){let m=localStorage.getItem("token");if(!m||!this.editedFarmer.id)return;let{id:e,name:o,email:r,phone:s,password:$,active:q}=this.editedFarmer,J={name:o,email:r,phone:s,password:$||"123"},E={Authorization:`Bearer ${m}`,"Content-Type":"application/json"};this.http.put(`http://localhost:8000/ADMINSERVICE/admin/farmer/${e}/update`,J,{headers:E}).subscribe({next:()=>{this.http.put(`http://localhost:8000/ADMINSERVICE/admin/farmer/${e}/status?active=${q}`,{},{headers:E,responseType:"text"}).subscribe({next:f=>{console.log(f),this.getAllFarmers(),this.cancelEdit()},error:f=>{console.error("Status update failed",f),alert("Farmer status update failed")}})},error:f=>{console.error("Profile update failed",f),alert("Farmer profile update failed")}})}static \u0275fac=function(e){return new(e||l)(w(D))};static \u0275cmp=y({type:l,selectors:[["app-farmers"]],decls:6,vars:3,consts:[["viewMode",""],[1,"farmers-container"],["class","error-message",4,"ngIf"],["class","farmers-table",4,"ngIf"],["class","no-farmers",4,"ngIf"],[1,"error-message"],[1,"farmers-table"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[3,"ngModelChange","ngModel"],[3,"value"],[3,"click"],[3,"href"],[1,"no-farmers"]],template:function(e,o){e&1&&(t(0,"div",1)(1,"h2"),a(2,"Farmers List"),n(),h(3,K,2,1,"div",2)(4,Z,17,1,"table",3)(5,ee,2,0,"div",4),n()),e&2&&(i(3),_("ngIf",o.errorMessage),i(),_("ngIf",o.farmers.length>0),i(),_("ngIf",o.farmers.length===0&&!o.errorMessage))},dependencies:[W,N,A,U,j,H,z,R,B,L],styles:[".farmers-container[_ngcontent-%COMP%]{max-width:1000px;margin:30px auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px;font-size:2rem;color:#2c3e50}.error-message[_ngcontent-%COMP%]{color:#e74c3c;font-weight:600;text-align:center;margin-bottom:20px}.no-farmers[_ngcontent-%COMP%]{text-align:center;font-style:italic;color:#7f8c8d;margin-top:30px}.farmers-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;box-shadow:0 0 10px #0000001a}.farmers-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .farmers-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:12px 16px;text-align:left}.farmers-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:600;color:#34495e}.farmers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#fafafa}.farmers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}a[_ngcontent-%COMP%]{color:#2980b9;text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.active[_ngcontent-%COMP%]{color:green;font-weight:700}.inactive[_ngcontent-%COMP%]{color:red;font-weight:700}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:4px;width:100%;box-sizing:border-box}button[_ngcontent-%COMP%]{margin:0 2px;padding:6px 10px;cursor:pointer;border:none;background-color:#3498db;color:#fff;border-radius:4px;font-size:.9rem}button[_ngcontent-%COMP%]:hover{background-color:#2980b9}"]})};export{G as FarmersComponent};
