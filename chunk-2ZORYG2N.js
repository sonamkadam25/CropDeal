import{d as T,h as F}from"./chunk-YHE6EI6Y.js";import{b as D}from"./chunk-VARBTXGR.js";import{Ea as M,Gb as P,Hb as O,Ia as v,Ib as w,Kb as k,Pa as d,Sa as o,Ta as n,Ua as y,Xa as S,Y as h,Ya as I,Z as b,Za as m,_a as E,db as r,eb as p,fb as g,kb as f,lb as u,sa as C,va as i,za as _}from"./chunk-LATPFVPJ.js";function $(a,t){if(a&1&&(o(0,"div",4),r(1),n()),a&2){let e=m();i(),p(e.errorMessage)}}function N(a,t){if(a&1){let e=S();o(0,"div",7)(1,"div",8),y(2,"span",9),o(3,"span",10),r(4),f(5,"titlecase"),n()(),o(6,"h3",11),r(7),f(8,"titlecase"),n(),o(9,"p")(10,"strong"),r(11,"Quantity:"),n(),r(12),n(),o(13,"p")(14,"strong"),r(15,"Price:"),n(),r(16),n(),o(17,"p")(18,"strong"),r(19,"Location:"),n(),r(20),f(21,"titlecase"),n(),o(22,"div",12)(23,"h4"),r(24,"Farmer Details"),n(),o(25,"p")(26,"strong"),r(27,"Name:"),n(),r(28),f(29,"titlecase"),n(),o(30,"p")(31,"strong"),r(32,"Email:"),n(),o(33,"a",13),r(34),n()(),o(35,"p")(36,"strong"),r(37,"Phone:"),n(),o(38,"a",13),r(39),n()()(),o(40,"div",14)(41,"button",15),I("click",function(){let l=h(e).$implicit,c=m(2);return b(c.viewCrop(l))}),r(42,"View Item"),n(),o(43,"button",16),I("click",function(){let l=h(e).$implicit,c=m(2);return b(c.subscribeToCrop(l))}),r(44," Subscribe "),n()()()}if(a&2){let e=t.$implicit;i(4),p(u(5,12,e.type)),i(3),p(u(8,14,e.name)),i(5),g(" ",e.quantity," kg"),i(4),g(" ",e.pricePerUnit," Rs/kg"),i(4),g(" ",u(21,16,e.location),""),i(8),g(" ",u(29,18,e.farmer.name),""),i(5),E("href","mailto:",e.farmer.email,"",C),i(),p(e.farmer.email),i(4),E("href","tel:",e.farmer.phone,"",C),i(),p(e.farmer.phone)}}function A(a,t){if(a&1&&(o(0,"div",5),v(1,N,45,20,"div",6),n()),a&2){let e=m();i(),d("ngForOf",e.crops)}}function Q(a,t){a&1&&(o(0,"div",17),r(1," No crops found. "),n())}var R=class a{constructor(t,e){this.http=t;this.router=e}allCrops=[];crops=[];errorMessage="";lastQuery="";ngOnInit(){this.getAllCrops()}ngDoCheck(){let t=localStorage.getItem("searchCropQuery")||"";t!==this.lastQuery&&(this.lastQuery=t,this.applyFilter(t))}getAllCrops(){let t=localStorage.getItem("token");if(!t){this.errorMessage="No auth token found. Please login again.";return}this.http.get("http://localhost:8000/DEALERSERVICE/dealer/allcrops",{headers:{Authorization:`Bearer ${t}`}}).subscribe({next:e=>{this.allCrops=e,this.applyFilter(localStorage.getItem("searchCropQuery")||"")},error:e=>{console.error("Error fetching crops:",e),this.errorMessage="Failed to load crops. Please try again later."}})}applyFilter(t){t?this.crops=this.allCrops.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())):this.crops=this.allCrops}viewCrop(t){localStorage.setItem("selectedCrop",JSON.stringify(t)),this.router.navigate(["/dealer/purchases"],{queryParams:{id:t.id}})}subscribeToCrop(t){let e=localStorage.getItem("token"),s=localStorage.getItem("email");if(!e||!s){this.errorMessage="Missing token or email. Please login again.";return}let l={Authorization:`Bearer ${e}`};this.http.get(`http://localhost:8000/DEALERSERVICE/dealer/email/${s}`,{headers:l}).subscribe({next:c=>{let z=c,V=t.id;this.http.post(`http://localhost:8000/DEALERSERVICE/dealer/subscribe?dealerId=${z}&cropId=${V}&dealerEmail=${s}`,{},{headers:l,responseType:"text"}).subscribe({next:x=>{console.log("\u2705 Subscription response:",x),alert("\u2705 Subscribed successfully to crop!")},error:x=>{console.error("\u274C Subscription failed",x),alert("\u274C Failed to subscribe. Try again later.")}})},error:c=>{console.error("\u274C Error fetching dealer ID",c),alert("\u274C Could not get dealer information.")}})}static \u0275fac=function(e){return new(e||a)(_(D),_(T))};static \u0275cmp=M({type:a,selectors:[["app-dashboard"]],decls:5,vars:3,consts:[[1,"dashboard-container"],["class","error-message",4,"ngIf"],["class","cards-grid",4,"ngIf"],["class","no-crops",4,"ngIf"],[1,"error-message"],[1,"cards-grid"],["class","crop-card",4,"ngFor","ngForOf"],[1,"crop-card"],[1,"card-header"],[1,"crop-id"],[1,"crop-type"],[1,"crop-name"],[1,"farmer-info"],[3,"href"],[1,"button-group"],[1,"view-button",3,"click"],[1,"subscribe-button",3,"click"],[1,"no-crops"]],template:function(e,s){e&1&&(o(0,"div",0),y(1,"h2"),v(2,$,2,1,"div",1)(3,A,2,1,"div",2)(4,Q,2,0,"div",3),n()),e&2&&(i(2),d("ngIf",s.errorMessage),i(),d("ngIf",s.crops.length>0),i(),d("ngIf",s.crops.length===0&&!s.errorMessage))},dependencies:[k,P,O,w,F],styles:[".dashboard-container[_ngcontent-%COMP%]{max-width:1350px;margin:0 auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#2c3e50}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;font-weight:700;font-size:2.4rem;color:#27ae60}.error-message[_ngcontent-%COMP%]{color:#e74c3c;font-weight:600;margin-bottom:20px;text-align:center}.no-crops[_ngcontent-%COMP%]{text-align:center;font-style:italic;color:#7f8c8d;margin-top:50px;font-size:1.2rem}.cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:23px;margin-top:100px}.crop-card[_ngcontent-%COMP%]{background-color:#f9f9f9;border-radius:12px;box-shadow:0 4px 10px #0000001a;padding:20px;transition:transform .2s ease,box-shadow .2s ease;display:flex;flex-direction:column;justify-content:space-between;cursor:default}.crop-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 20px #00000026}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;margin-bottom:10px;color:#2980b9;font-size:.9rem}.crop-name[_ngcontent-%COMP%]{margin:0 0 15px;color:#27ae60;font-size:1.4rem;font-weight:700}.crop-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:1rem}.farmer-info[_ngcontent-%COMP%]{margin-top:15px;padding-top:10px;border-top:1px solid #ddd}.farmer-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:1.1rem;font-weight:600;color:#34495e}.farmer-info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2980b9;text-decoration:none}.farmer-info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.view-button[_ngcontent-%COMP%]{margin-top:15px;padding:10px 15px;background-color:#27ae60;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:background-color .3s ease}.view-button[_ngcontent-%COMP%]:hover{background-color:#219150}.subscribe-button[_ngcontent-%COMP%]{margin-top:15px;padding:10px 15px;background-color:#27ae60;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:background-color .3s ease}.subscribe-button[_ngcontent-%COMP%]:hover{background-color:#219150}.button-group[_ngcontent-%COMP%]{display:flex;gap:10px}"]})};export{R as DashboardComponent};
