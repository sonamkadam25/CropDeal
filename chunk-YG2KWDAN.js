import{h as S}from"./chunk-YHE6EI6Y.js";import{b as D}from"./chunk-VARBTXGR.js";import{Ea as v,Gb as E,Hb as O,Ia as x,Ib as I,Kb as P,Pa as l,Sa as i,Ta as t,Xa as M,Y as C,Ya as y,Z as b,Za as d,_a as u,db as n,eb as c,fb as g,kb as p,lb as m,sa as h,va as o,za as _}from"./chunk-LATPFVPJ.js";function T(s,r){if(s&1&&(i(0,"div",4),n(1),t()),s&2){let e=d();o(),c(e.errorMessage)}}function z(s,r){if(s&1){let e=M();i(0,"div",7)(1,"div",8)(2,"span",9),n(3),p(4,"titlecase"),t(),i(5,"button",10),y("click",function(){let f=C(e).$implicit,k=d(2);return b(k.deleteCrop(f.id))}),n(6," Delete "),t()(),i(7,"h3",11),n(8),p(9,"titlecase"),t(),i(10,"p")(11,"strong"),n(12,"Quantity:"),t(),n(13),t(),i(14,"p")(15,"strong"),n(16,"Location:"),t(),n(17),p(18,"titlecase"),t(),i(19,"div",12)(20,"h4"),n(21,"Farmer Details"),t(),i(22,"p")(23,"strong"),n(24,"Name:"),t(),n(25),p(26,"titlecase"),t(),i(27,"p")(28,"strong"),n(29,"Email:"),t(),i(30,"a",13),n(31),t()(),i(32,"p")(33,"strong"),n(34,"Phone:"),t(),i(35,"a",13),n(36),t()()()()}if(s&2){let e=r.$implicit,a=d(2);o(3),c(m(4,12,e.type)),o(2),l("disabled",a.isDeleting),o(3),c(m(9,14,e.name)),o(5),g(" ",e.quantity,""),o(4),g(" ",m(18,16,e.location),""),o(8),g(" ",m(26,18,e.farmer.name),""),o(5),u("href","mailto:",e.farmer.email,"",h),o(),c(e.farmer.email),o(4),u("href","tel:",e.farmer.phone,"",h),o(),c(e.farmer.phone)}}function N(s,r){if(s&1&&(i(0,"div",5),x(1,z,37,20,"div",6),t()),s&2){let e=d();o(),l("ngForOf",e.crops)}}function A(s,r){s&1&&(i(0,"div",14),n(1," No crops found. "),t())}var w=class s{constructor(r){this.http=r}crops=[];errorMessage="";isDeleting=!1;successMessage="";ngOnInit(){this.getAllCrops()}getAllCrops(){let r=localStorage.getItem("token");if(console.log("Auth token used get all crops:",r),!r){this.errorMessage="No auth token found. Please login again.";return}this.http.get("http://localhost:8000/ADMINSERVICE/admin/allcrops",{headers:{Authorization:`Bearer ${r}`}}).subscribe({next:e=>{this.crops=e},error:e=>{console.error("Error fetching crops:",e),this.errorMessage="Failed to load crops. Please try again later."}})}deleteCrop(r){let e=localStorage.getItem("token");if(console.log("--- DELETE Request Triggered ---"),console.log("Crop ID to delete:",r),console.log("Token from localStorage:",e),!e){this.errorMessage="No auth token found. Please login again.",console.warn("No token found.");return}if(!confirm("Are you sure you want to delete this crop?")){console.log("User canceled deletion.");return}this.isDeleting=!0,this.errorMessage="",this.successMessage="",this.http.delete(`http://localhost:8000/ADMINSERVICE/admin/deleteCrop/${r}`,{headers:{Authorization:`Bearer ${e}`},responseType:"text"}).subscribe({next:a=>{console.log("Successfully deleted crop:",a),this.crops=this.crops.filter(f=>f.id!==r),this.isDeleting=!1,this.successMessage=a},error:a=>{console.error("--- ERROR Deleting Crop ---"),console.error("Status:",a.status),console.error("Error Object:",a),a.status===403?this.errorMessage="Access denied. You do not have permission to delete this crop.":this.errorMessage="Failed to delete crop. Please try again later.",this.isDeleting=!1}})}static \u0275fac=function(e){return new(e||s)(_(D))};static \u0275cmp=v({type:s,selectors:[["app-dashboard"]],decls:4,vars:3,consts:[[1,"dashboard-container"],["class","error-message",4,"ngIf"],["class","cards-grid",4,"ngIf"],["class","no-crops",4,"ngIf"],[1,"error-message"],[1,"cards-grid"],["class","crop-card",4,"ngFor","ngForOf"],[1,"crop-card"],[1,"card-header"],[1,"crop-type"],["title","Delete Crop",1,"delete-btn",3,"click","disabled"],[1,"crop-name"],[1,"farmer-info"],[3,"href"],[1,"no-crops"]],template:function(e,a){e&1&&(i(0,"div",0),x(1,T,2,1,"div",1)(2,N,2,1,"div",2)(3,A,2,0,"div",3),t()),e&2&&(o(),l("ngIf",a.errorMessage),o(),l("ngIf",a.crops.length>0),o(),l("ngIf",a.crops.length===0&&!a.errorMessage))},dependencies:[P,E,O,I,S],styles:[".dashboard-container[_ngcontent-%COMP%]{max-width:1350px;margin:0 auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#2c3e50}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;font-weight:700;font-size:2.4rem;color:#27ae60}.error-message[_ngcontent-%COMP%]{color:#e74c3c;font-weight:600;margin-bottom:20px;text-align:center}.no-crops[_ngcontent-%COMP%]{text-align:center;font-style:italic;color:#7f8c8d;margin-top:50px;font-size:1.2rem}.cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:23px}.crop-card[_ngcontent-%COMP%]{background-color:#f9f9f9;border-radius:12px;box-shadow:0 4px 10px #0000001a;padding:20px;transition:transform .2s ease,box-shadow .2s ease;display:flex;flex-direction:column;justify-content:space-between;cursor:default}.crop-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 20px #00000026}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-weight:600;margin-bottom:10px;color:#2980b9;font-size:.9rem}.crop-name[_ngcontent-%COMP%]{margin:0 0 15px;color:#27ae60;font-size:1.4rem;font-weight:700}.crop-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:1rem}.farmer-info[_ngcontent-%COMP%]{margin-top:15px;padding-top:10px;border-top:1px solid #ddd}.farmer-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:1.1rem;font-weight:600;color:#34495e}.farmer-info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2980b9;text-decoration:none}.farmer-info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.delete-btn[_ngcontent-%COMP%]{background-color:#e74c3c;border:none;color:#fff;padding:6px 12px;border-radius:6px;font-size:.85rem;font-weight:600;cursor:pointer;transition:background-color .2s ease}.delete-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#c0392b}.delete-btn[_ngcontent-%COMP%]:disabled{background-color:#f1948a;cursor:not-allowed}"]})};export{w as DashboardComponent};
