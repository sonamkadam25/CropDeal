import{a as F,c as I,d as y,f as w,h as O,i as N,j as B,k as V,l as T,m as A,o as D}from"./chunk-MDTR3QT2.js";import{a as b,b as k}from"./chunk-VARBTXGR.js";import{Ea as h,Fb as P,Hb as M,Ia as C,Kb as E,Pa as s,Sa as n,Ta as t,Ua as f,Xa as _,Y as d,Ya as g,Z as u,Za as c,db as i,eb as x,fb as S,va as l,za as v}from"./chunk-LATPFVPJ.js";function j(r,a){if(r&1){let e=_();n(0,"form",7),g("ngSubmit",function(){d(e);let o=c(2);return u(o.saveProfile())}),n(1,"h2"),i(2,"Edit Farmer Profile"),t(),n(3,"div",8)(4,"label"),i(5,"Name"),t(),f(6,"input",9),t(),n(7,"div",8)(8,"label"),i(9,"Email"),t(),f(10,"input",10),t(),n(11,"div",8)(12,"label"),i(13,"Phone"),t(),f(14,"input",11),t(),n(15,"div",8)(16,"label"),i(17,"Status"),t(),n(18,"select",12)(19,"option",13),i(20,"Active"),t(),n(21,"option",13),i(22,"Inactive"),t()()(),n(23,"button",14),i(24,"Save Profile"),t()()}if(r&2){let e=c(2);s("formGroup",e.profileForm),l(19),s("value",!0),l(2),s("value",!1)}}function z(r,a){if(r&1&&(n(0,"div",15)(1,"h2"),i(2,"Farmer Profile"),t(),n(3,"div",8)(4,"label"),i(5,"Farmer Id"),t(),n(6,"span"),i(7),t()(),n(8,"div",8)(9,"label"),i(10,"Name"),t(),n(11,"span"),i(12),t()(),n(13,"div",8)(14,"label"),i(15,"Email"),t(),n(16,"span"),i(17),t()(),n(18,"div",8)(19,"label"),i(20,"Phone"),t(),n(21,"span"),i(22),t()(),n(23,"div",8)(24,"label"),i(25,"Status"),t(),n(26,"span",16),i(27),t()()()),r&2){let e=c(2);l(7),x(e.farmer.id),l(5),x(e.farmer.name),l(5),x(e.farmer.email),l(5),x(e.farmer.phone),l(4),s("ngClass",e.farmer.active?"status-active":"status-inactive"),l(),S(" ",e.farmer.active?"Active":"Inactive"," ")}}function H(r,a){if(r&1){let e=_();n(0,"div",2),C(1,j,25,3,"form",3)(2,z,28,6,"div",4),n(3,"div",5)(4,"button",6),g("click",function(){d(e);let o=c();return u(o.enableEdit())}),i(5,"Update Profile"),t(),n(6,"button",6),g("click",function(){d(e);let o=c();return u(o.toggleBankForm())}),i(7,"Add Bank Details"),t()()()}if(r&2){let e=c();l(),s("ngIf",e.updateMode),l(),s("ngIf",!e.updateMode)}}function $(r,a){if(r&1){let e=_();n(0,"div",2)(1,"form",7),g("ngSubmit",function(){d(e);let o=c();return u(o.submitBankDetails())}),n(2,"h2"),i(3,"Bank Details"),t(),n(4,"div",8)(5,"label"),i(6,"Account Number"),t(),f(7,"input",17),t(),n(8,"div",8)(9,"label"),i(10,"IFSC Code"),t(),f(11,"input",18),t(),n(12,"div",8)(13,"label"),i(14,"Bank Name"),t(),f(15,"input",19),t(),n(16,"div",5)(17,"button",14),i(18,"Save Bank Details"),t(),n(19,"button",20),g("click",function(){d(e);let o=c();return u(o.toggleBankForm())}),i(20,"Cancel"),t()()()()}if(r&2){let e=c();l(),s("formGroup",e.bankForm)}}function U(r,a){if(r&1&&(n(0,"p",21),i(1),t()),r&2){let e=c();l(),x(e.errorMessage)}}var R=class r{constructor(a,e){this.http=a;this.fb=e}farmer=null;errorMessage="";updateMode=!1;showBankForm=!1;profileForm;bankForm;ngOnInit(){let a=localStorage.getItem("token"),e=localStorage.getItem("email");if(!a||!e){this.errorMessage="No auth token or email found. Please login again.";return}let m=new b({Authorization:`Bearer ${a}`});this.http.get("http://localhost:8000/FARMERSERVICE/farmers/crops/all",{headers:m}).subscribe({next:o=>{let p=o.filter(G=>G.farmer.email===e);p.length>0?(this.farmer=p[0].farmer,this.initProfileForm(),this.initBankForm()):this.errorMessage="No farmer profile found."},error:o=>{this.errorMessage="Failed to fetch farmer profile.",console.error(o)}})}currentSection="view";initProfileForm(){this.profileForm=this.fb.group({id:[this.farmer.id],name:[this.farmer.name],email:[this.farmer.email],phone:[this.farmer.phone],active:[this.farmer.active]})}initBankForm(){this.bankForm=this.fb.group({accountNumber:[""],ifsc:[""],bankName:[""]})}enableEdit(){this.updateMode=!0}saveProfile(){let a=localStorage.getItem("token"),e=localStorage.getItem("farmerId");if(!a||!e){this.errorMessage="Missing authentication details.";return}let m=new b({Authorization:`Bearer ${a}`,"Content-Type":"application/json"}),o=this.profileForm.value;this.http.put(`http://localhost:8000/FARMERSERVICE/farmers/${e}/update`,o,{headers:m}).subscribe({next:p=>{this.farmer=p,this.updateMode=!1,alert("Profile updated successfully!")},error:p=>{console.error(p),this.errorMessage="Failed to update profile."}})}toggleBankForm(){this.showBankForm=!this.showBankForm}submitBankDetails(){let a=localStorage.getItem("token"),e=localStorage.getItem("farmerId");if(!a||!e){this.errorMessage="Missing authentication details.";return}let m=new b({Authorization:`Bearer ${a}`,"Content-Type":"application/json"}),o=this.bankForm.value;this.http.post(`http://localhost:8000/FARMERSERVICE/farmers/${e}/bank`,o,{headers:m,responseType:"text"}).subscribe({next:p=>{alert(p),this.showBankForm=!1,this.bankForm.reset()},error:p=>{console.error(p),this.errorMessage="Failed to add bank details."}})}static \u0275fac=function(e){return new(e||r)(v(k),v(A))};static \u0275cmp=h({type:r,selectors:[["app-profile"]],decls:3,vars:3,consts:[["class","profile-container",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"profile-container"],["class","profile-card",3,"formGroup","ngSubmit",4,"ngIf"],["class","profile-card",4,"ngIf"],[1,"button-group"],[3,"click"],[1,"profile-card",3,"ngSubmit","formGroup"],[1,"profile-field"],["type","text","formControlName","name"],["type","email","formControlName","email"],["type","text","formControlName","phone"],["formControlName","active"],[3,"value"],["type","submit"],[1,"profile-card"],[3,"ngClass"],["type","text","formControlName","accountNumber"],["type","text","formControlName","ifsc"],["type","text","formControlName","bankName"],["type","button",3,"click"],[1,"error-message"]],template:function(e,m){e&1&&C(0,H,8,2,"div",0)(1,$,21,1,"div",0)(2,U,2,1,"p",1),e&2&&(s("ngIf",m.farmer),l(),s("ngIf",m.showBankForm),l(),s("ngIf",m.errorMessage))},dependencies:[E,P,M,D,w,V,T,F,B,I,y,O,N],styles:[".profile-container[_ngcontent-%COMP%]{max-width:500px;margin:110px auto;padding:24px;background-color:#f9f9f9;border-radius:16px;box-shadow:0 4px 8px #0000001a}.profile-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.profile-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:12px;color:#2c3e50}.profile-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.profile-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#34495e;margin-bottom:6px}.profile-field[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .profile-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .profile-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:16px;padding:8px;border:1px solid #ccc;border-radius:8px;background-color:#fff}.profile-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .profile-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#2980b9}.button-group[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:16px}button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#2980b9;color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:16px;transition:background-color .3s}button[_ngcontent-%COMP%]:hover{background-color:#1f6391}.status-active[_ngcontent-%COMP%]{color:green;font-weight:700}.status-inactive[_ngcontent-%COMP%]{color:red;font-weight:700}.error-message[_ngcontent-%COMP%]{color:red;text-align:center;margin-top:20px}.profile-container[_ngcontent-%COMP%]{transition:all .3s ease-in-out}"]})};export{R as ProfileComponent};
