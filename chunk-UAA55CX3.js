import{a as y,b as w}from"./chunk-VARBTXGR.js";import{Ea as u,Gb as E,Hb as M,Ia as v,Jb as P,Kb as O,Pa as d,Sa as s,Ta as n,Xa as _,Y as g,Ya as C,Z as f,Za as m,db as i,eb as b,fb as p,kb as I,mb as h,va as c,za as x}from"./chunk-LATPFVPJ.js";function D(o,t){o&1&&(s(0,"div",5),i(1,"Loading receipts..."),n())}function N(o,t){if(o&1&&(s(0,"div",6),i(1),n()),o&2){let e=m();c(),b(e.errorMessage)}}function k(o,t){o&1&&(s(0,"div",7),i(1," No receipts found. "),n())}function R(o,t){if(o&1){let e=_();s(0,"div",8)(1,"p")(2,"strong"),i(3,"Receipt ID:"),n(),i(4),n(),s(5,"p")(6,"strong"),i(7,"Dealer Name:"),n(),i(8),n(),s(9,"p")(10,"strong"),i(11,"Amount Paid:"),n(),i(12),n(),s(13,"p")(14,"strong"),i(15,"Crop Name:"),n(),i(16),n(),s(17,"p")(18,"strong"),i(19,"Date:"),n(),i(20),I(21,"date"),n(),s(22,"button",9),C("click",function(){let l=g(e).$implicit,r=m();return f(r.downloadReceipt(l))}),i(23,"Download"),n()()}if(o&2){let e=t.$implicit;c(4),p(" ",e.id,""),c(4),p(" ",e.dealerName,""),c(4),p(" \u20B9",e.amount,""),c(4),p(" ",e.cropName,""),c(4),p(" ",h(21,5,e.date,"medium"),"")}}var S=class o{constructor(t){this.http=t}receipts=[];loading=!0;errorMessage="";ngOnInit(){let t=localStorage.getItem("token"),e=localStorage.getItem("email");if(!t||!e){this.errorMessage="Unauthorized. Please login again.",this.loading=!1;return}let a=new y({Authorization:`Bearer ${t}`});this.http.get(`http://localhost:8000/DEALERSERVICE/dealer/email/${e}`,{headers:a}).subscribe({next:l=>{this.http.get(`http://localhost:8000/PAYMENTSERVICE/payment/invoice/${l}`,{headers:a}).subscribe({next:r=>{this.receipts=Array.isArray(r)?r:[r],this.loading=!1},error:r=>{console.error("\u274C Error fetching receipts:",r),this.errorMessage=r.error?.message||"Failed to load receipts.",this.loading=!1}})},error:l=>{console.error("\u274C Error fetching dealer ID:",l),this.errorMessage="Could not retrieve dealer info. Please try again.",this.loading=!1}})}downloadReceipt(t){let e=`
Receipt ID: ${t.id}
Dealer Name: ${t.dealerName}
Amount Paid: \u20B9${t.amount}
Crop Name: ${t.cropName}
Date: ${new Date(t.date).toLocaleString()}
`,a=new Blob([e],{type:"text/plain"}),l=window.URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download=`receipt-${t.id}.txt`,r.click(),window.URL.revokeObjectURL(l)}static \u0275fac=function(e){return new(e||o)(x(w))};static \u0275cmp=u({type:o,selectors:[["app-invoices"]],decls:7,vars:4,consts:[[1,"receipts-container"],["class","loading-text",4,"ngIf"],["class","error-text",4,"ngIf"],["class","no-receipts",4,"ngIf"],["class","receipt-card",4,"ngFor","ngForOf"],[1,"loading-text"],[1,"error-text"],[1,"no-receipts"],[1,"receipt-card"],[3,"click"]],template:function(e,a){e&1&&(s(0,"div",0)(1,"h2"),i(2,"Payment Receipts"),n(),v(3,D,2,0,"div",1)(4,N,2,1,"div",2)(5,k,2,0,"div",3)(6,R,24,8,"div",4),n()),e&2&&(c(3),d("ngIf",a.loading),c(),d("ngIf",a.errorMessage),c(),d("ngIf",!a.loading&&a.receipts.length===0),c(),d("ngForOf",a.receipts))},dependencies:[O,E,M,P],styles:[".receipts-container[_ngcontent-%COMP%]{max-width:700px;margin:110px auto;padding:25px;background:#fefefe;border-radius:12px;box-shadow:0 10px 25px #0000001a;font-family:Segoe UI,sans-serif}.receipts-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;color:#2c3e50;margin-bottom:30px}.receipt-card[_ngcontent-%COMP%]{background:#f9f9f9;border:1px solid #ddd;padding:20px;margin-bottom:15px;border-radius:8px;transition:.3s}.receipt-card[_ngcontent-%COMP%]:hover{background-color:#f1f9ff;border-color:#bcdfff}.receipt-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;color:#34495e;font-size:15px}.loading-text[_ngcontent-%COMP%], .error-text[_ngcontent-%COMP%], .no-receipts[_ngcontent-%COMP%]{text-align:center;margin-top:20px;font-size:16px}.error-text[_ngcontent-%COMP%]{color:#e74c3c}.no-receipts[_ngcontent-%COMP%]{color:#7f8c8d}.receipt-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;padding:8px 12px;font-size:14px;color:#fff;background-color:#2ecc71;border:none;border-radius:6px;cursor:pointer;transition:background-color .2s ease}.receipt-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#27ae60}"]})};export{S as InvoicesComponent};
