import{b as z}from"./chunk-VARBTXGR.js";import{Ea as v,Hb as M,Ia as P,Ib as D,Jb as O,Kb as N,Pa as d,Sa as r,Ta as e,Xa as _,Y as y,Ya as C,Z as S,Za as u,a as h,b as I,db as t,eb as b,fb as a,kb as g,lb as f,mb as k,va as o,za as E}from"./chunk-LATPFVPJ.js";function B(l,i){if(l&1){let n=_();r(0,"div",3)(1,"h2"),t(2,"Crop Details"),e(),r(3,"div",4)(4,"div",5)(5,"h3"),t(6),g(7,"titlecase"),e(),r(8,"p")(9,"strong"),t(10,"Type:"),e(),t(11),e(),r(12,"p")(13,"strong"),t(14,"Quantity:"),e(),t(15),e(),r(16,"p")(17,"strong"),t(18,"Price:"),e(),t(19),e(),r(20,"p")(21,"strong"),t(22,"Location:"),e(),t(23),e()(),r(24,"div",5)(25,"h4"),t(26,"Farmer Info"),e(),r(27,"p")(28,"strong"),t(29,"Farmer Id:"),e(),t(30),e(),r(31,"p")(32,"strong"),t(33,"Name:"),e(),t(34),e(),r(35,"p")(36,"strong"),t(37,"Email:"),e(),t(38),e(),r(39,"p")(40,"strong"),t(41,"Phone:"),e(),t(42),e(),r(43,"p")(44,"strong"),t(45,"Active:"),e(),t(46),e()(),r(47,"div",5)(48,"h4"),t(49,"Bank Details"),e(),r(50,"p")(51,"strong"),t(52,"Bank Name:"),e(),t(53),e(),r(54,"p")(55,"strong"),t(56,"Account Number:"),e(),t(57),e(),r(58,"p")(59,"strong"),t(60,"IFSC:"),e(),t(61),e()()(),r(62,"div",6)(63,"button",7),C("click",function(){y(n);let m=u();return S(m.purchaseCrop())}),t(64," Pay & Purchase "),e()()()}if(l&2){let n=u();o(6),b(f(7,13,n.crop.name)),o(5),a(" ",n.crop.type,""),o(4),a(" ",n.crop.quantity," kg"),o(4),a(" ",n.crop.pricePerUnit," Rs/kg"),o(4),a(" ",n.crop.location,""),o(7),a(" ",n.crop.farmer.id,""),o(4),a(" ",n.crop.farmer.name,""),o(4),a(" ",n.crop.farmer.email,""),o(4),a(" ",n.crop.farmer.phone,""),o(4),a(" ",n.crop.farmer.active?"Yes":"No",""),o(7),a(" ",n.crop.farmer.bankDetails.bankName,""),o(4),a(" ",n.crop.farmer.bankDetails.accountNumber," "),o(4),a(" ",n.crop.farmer.bankDetails.ifsc,"")}}function A(l,i){l&1&&(r(0,"div",8),t(1,"Loading crop details..."),e())}function R(l,i){if(l&1&&(r(0,"div",9)(1,"h2",10),t(2,"\u2705 Payment Successful"),e(),r(3,"div",11)(4,"p")(5,"strong"),t(6,"Payment ID:"),e(),t(7),e(),r(8,"p")(9,"strong"),t(10,"Dealer ID:"),e(),t(11),e(),r(12,"p")(13,"strong"),t(14,"Farmer ID:"),e(),t(15),e(),r(16,"p")(17,"strong"),t(18,"Amount Paid:"),e(),t(19),e(),r(20,"p")(21,"strong"),t(22,"Product:"),e(),t(23),g(24,"titlecase"),e(),r(25,"p")(26,"strong"),t(27,"Timestamp:"),e(),t(28),g(29,"date"),e()()()),l&2){let n=u();o(7),a(" ",n.orderSummary==null?null:n.orderSummary.paymentId,""),o(4),a(" ",n.orderSummary==null?null:n.orderSummary.dealerId,""),o(4),a(" ",n.orderSummary==null?null:n.orderSummary.farmerId,""),o(4),a(" \u20B9",(n.orderSummary==null?null:n.orderSummary.amount)/100,""),o(4),a(" ",f(24,6,n.orderSummary==null?null:n.orderSummary.productName),""),o(5),a(" ",k(29,8,n.orderSummary==null?null:n.orderSummary.timestamp,"short")," ")}}var w=class l{constructor(i){this.http=i}crop=null;dealerId=null;viewSuccessPage=!1;orderSummary=null;ngOnInit(){let i=localStorage.getItem("selectedCrop");if(i)this.crop=JSON.parse(i);else{console.error("No crop data found in localStorage");return}let n=localStorage.getItem("email"),c=localStorage.getItem("token");if(n&&c){let m={Authorization:`Bearer ${c}`};this.http.get(`http://localhost:8000/DEALERSERVICE/dealer/email/${n}`,{headers:m}).subscribe({next:s=>{this.dealerId=s,console.log("\u2705 Dealer ID:",this.dealerId)},error:s=>{console.error("\u274C Error fetching dealer ID",s)}})}else console.error("Missing email or token in localStorage")}purchaseCrop(){if(console.log("\u2705 Purchase button clicked"),!this.crop||!this.dealerId){console.warn("\u274C Missing crop or dealerId");return}let i=localStorage.getItem("token"),n=localStorage.getItem("email");if(!i){console.error("\u274C No token found in localStorage");return}let c={Authorization:`Bearer ${i}`},m={dealerId:this.dealerId,farmerId:this.crop.farmer.id,amount:this.crop.quantity,productName:this.crop.name,dealerEmail:n};console.log("\u{1F4E6} Sending order payload:",m),this.http.post("http://localhost:8000/PAYMENTSERVICE/payment/create",m,{headers:c}).subscribe({next:s=>{console.log("\u2705 Razorpay order created:",s);let T={key:"rzp_test_PHkgB0mPE51dG7",amount:s.amount,currency:s.currency||"INR",name:"CropDeal Purchase",description:m.productName,image:"https://your-logo.com/logo.png",order_id:s.id,handler:p=>{console.log("\u2705 Payment successful:",p),this.orderSummary=I(h({paymentId:p.razorpay_payment_id,orderId:p.razorpay_order_id,signature:p.razorpay_signature},m),{timestamp:new Date}),this.http.post("http://localhost:8000/PAYMENTSERVICE/payment/confirm",{dealerEmail:n,productName:m.productName,amount:m.amount,razorpayPaymentId:p.razorpay_payment_id},{headers:{Authorization:`Bearer ${i}`}}).subscribe({next:x=>console.log("\u{1F4E9} Email sent:",x),error:x=>console.error("\u274C Failed to confirm payment:",x)}),this.viewSuccessPage=!0},prefill:{name:localStorage.getItem("username")||"Dealer",email:localStorage.getItem("email")||"test@example.com",contact:"9999999999"},theme:{color:"#27ae60"}};new Razorpay(T).open()},error:s=>{console.error("\u274C Payment initiation failed:",s)}})}static \u0275fac=function(n){return new(n||l)(E(z))};static \u0275cmp=v({type:l,selectors:[["app-purchases"]],decls:3,vars:3,consts:[["class","purchase-container",4,"ngIf"],["class","loading",4,"ngIf"],["class","success-page",4,"ngIf"],[1,"purchase-container"],[1,"crop-info"],[1,"info-section"],[1,"purchase-action"],[1,"purchase-button",3,"click"],[1,"loading"],[1,"success-page"],[1,"success-heading"],[1,"success-details"]],template:function(n,c){n&1&&P(0,B,65,15,"div",0)(1,A,2,0,"div",1)(2,R,30,11,"div",2),n&2&&(d("ngIf",c.crop&&!c.viewSuccessPage),o(),d("ngIf",!c.crop),o(),d("ngIf",c.viewSuccessPage))},dependencies:[N,M,D,O],styles:[".purchase-container[_ngcontent-%COMP%]{max-width:900px;margin:140px auto;padding:25px;border-radius:12px;background-color:#f8f9fa;box-shadow:0 4px 10px #0000001a;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#2c3e50}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:25px;color:#27ae60;font-size:2rem}.crop-info[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:25px}.info-section[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:10px;border-left:5px solid #27ae60}.info-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .info-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:15px;color:#34495e}.info-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;font-size:1rem}.purchase-action[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.purchase-button[_ngcontent-%COMP%]{padding:12px 30px;font-size:1rem;background-color:#27ae60;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:background-color .3s}.purchase-button[_ngcontent-%COMP%]:hover{background-color:#219653}.success-msg[_ngcontent-%COMP%]{color:#2ecc71;font-weight:700;margin-top:15px;font-size:1.1rem}.loading[_ngcontent-%COMP%]{text-align:center;font-style:italic;color:#7f8c8d;margin-top:30px}.success-page[_ngcontent-%COMP%]{max-width:600px;margin:50px auto;padding:30px;background-color:#e8f9f1;border-left:6px solid #27ae60;border-radius:10px;text-align:center;box-shadow:0 4px 10px #0000001a;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#2c3e50}.success-heading[_ngcontent-%COMP%]{color:#27ae60;margin-bottom:20px}.success-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;margin:10px 0}"]})};export{w as PurchasesComponent};
